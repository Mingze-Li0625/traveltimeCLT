<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to traveltimeCLT: Predictive inference for travel time on transportation networks • traveltimeCLT</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to traveltimeCLT: Predictive inference for travel time on transportation networks">
<meta property="og:description" content="traveltimeCLT">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">traveltimeCLT</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/traveltimeCLT.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sample_ride.html">Sampling rides independently of the road-graph</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/melmasri/traveltimeCLT/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="traveltimeCLT_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="traveltimeCLT_files/kePrint-0.0.1/kePrint.js"></script><link href="traveltimeCLT_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to traveltimeCLT: Predictive inference for travel time on transportation networks</h1>
                        <h4 data-toc-skip class="author">Mohamad Elmasri, Aurélie Labbe, Denis Larocque, Laurent Charlin and Éric Germain</h4>
            
            <h4 data-toc-skip class="date">2024-05-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/melmasri/traveltimeCLT/blob/HEAD/vignettes/traveltimeCLT.Rmd" class="external-link"><code>vignettes/traveltimeCLT.Rmd</code></a></small>
      <div class="hidden name"><code>traveltimeCLT.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Mobility is vital to human activities, as it is an integral component of our economic and trade networks, social interactions, political ties, and our quality of life. Large-scale trip-level data, with temporal and spatial coverage, enable us to better diagnose transportation problems and develop efficient solutions, for instance, to increased congestion-levels. Such data is progressively available from global positioning systems (GPS) on mobile phones and other devices. At the heart of many such transportation problems is the estimation of travel time between locations.</p>
<p>This <code>traveltimeCLT</code> package provides a novel method implmented in <a href="https://arxiv.org/abs/2004.11292" class="external-link">Elmasri et. al. (2020)</a> for generating prediction intervals for travel time along a given route. By accounting for temporal-dependency in vehicle speeds, the parameters of the Gaussian asymptotic distribution for travel time normalized by distance are esimtated with less (or negligable) empirical bias compared to alternative methods.</p>
</div>
<div class="section level2">
<h2 id="example-data-set-trips">Example data set: <code>trips</code><a class="anchor" aria-label="anchor" href="#example-data-set-trips"></a>
</h2>
<p>This package includes a small data set (<code>trips</code>) that aggregates map-matched anonymized mobile phone GPS data collected in Quebec city in 2014 using the Mon Trajet smartphone application developed by <a href="https://brisksynergies.com/" class="external-link">Brisk Synergies Inc</a>. The precise duration of the time period is kept confidential.</p>
<p><code>trips</code> is used to explore methods offered in this package. Data similar to <code>trips</code> can be generated using other sources of GPS data, however, a preprocessing stage is necessary to map-match and aggregate the information up to the road segment (link) level. Such preprocessing is already performed on <code>trips</code>.</p>
<p><code>traveltimeCLT</code> does not perform this preprocessing stage, and the software cannot make use of raw GPS data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/melmasri/traveltimeCLT" class="external-link">traveltimeCLT</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">trips</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trips</span><span class="op">)</span></span>
<span><span class="co">#&gt;   tripID linkID timeBin     speed duration_secs distance_meters</span></span>
<span><span class="co">#&gt; 1   2700  10469 Weekday  5.431914     13.000000        70.61488</span></span>
<span><span class="co">#&gt; 2   2700  10444 Weekday  9.219505     18.927792       174.50487</span></span>
<span><span class="co">#&gt; 3   2700  10460 Weekday  9.052796      8.589937        77.76295</span></span>
<span><span class="co">#&gt; 4   2700  10462 Weekday  6.850282     14.619859       100.15015</span></span>
<span><span class="co">#&gt; 5   2700  10512 Weekday  6.075674      5.071986        30.81574</span></span>
<span><span class="co">#&gt; 6   2700   5890 Weekday 10.771731     31.585355       340.22893</span></span>
<span><span class="co">#&gt;            entry_time</span></span>
<span><span class="co">#&gt; 1 2014-04-28 11:07:27</span></span>
<span><span class="co">#&gt; 2 2014-04-28 11:07:41</span></span>
<span><span class="co">#&gt; 3 2014-04-28 11:07:58</span></span>
<span><span class="co">#&gt; 4 2014-04-28 11:08:07</span></span>
<span><span class="co">#&gt; 5 2014-04-28 11:08:21</span></span>
<span><span class="co">#&gt; 6 2014-04-28 11:08:26</span></span></code></pre></div>
<p>Travel data is organized around the notions of <em>trips</em> and <em>links</em>. Links are road segments each with well-defined beginning and end points and which can be traversed. A vehicle performs a trip when it travels from a start point to an end point through a sequence of links. Thus trips can be considered as ordered sequences of links. <code>trips</code> includes data for a collection of trips.</p>
<ul>
<li><p>Field <code>tripID</code> contains each <em>trip</em>’s ID, whereas field <code>linkID</code> contains the IDs of each <em>link</em> making up a trip. Both fields need to be numerical. It is assumed that, in the data set, all trips are grouped together and all links of a given trip appear in the order in which they are traversed (No verification is performed to that effect). A given link corresponds to some physical entity such as a road segment, a portion of a road segment, or any combination of those. Hence, it is expected that links are used in more than one trip.</p></li>
<li><p>Field <code>timeBin</code> (character string, or factor) refers to the time “category” when the traversal of a given link occurred. Time bins should reflect as much as possible time periods of the week encompassing similar traffic classes. In <code>trips</code> we define five time bins: <code>Weekday</code>, <code>MorningRush</code>, <code>EveningRush</code>, <code>EveningNight</code> and <code>Weekendday</code>.</p></li>
</ul>
<pre><code><span><span class="co">#&gt; Warning in !is.null(rmarkdown::metadata$output) &amp;&amp; rmarkdown::metadata$output</span></span>
<span><span class="co">#&gt; %in% : 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'</span></span></code></pre>
<table class="table table" style="margin-left: auto; margin-right: auto;">
<caption>
Table 1 - Example from <code>trips</code> : Time bin by period of the week
</caption>
<thead><tr>
<th style="text-align:left;">
Period of the week
</th>
<th style="text-align:left;">
Time bin
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Mon - Fri outside rush hour
</td>
<td style="text-align:left;">
Weekday
</td>
</tr>
<tr>
<td style="text-align:left;">
Mon - Fri, 7AM - 9AM
</td>
<td style="text-align:left;">
MorningRush
</td>
</tr>
<tr>
<td style="text-align:left;">
Mon - Fri, 3PM - 6PM
</td>
<td style="text-align:left;">
EveningRush
</td>
</tr>
<tr>
<td style="text-align:left;">
Sat 9AM - 9PM + Sun 9AM - 7PM
</td>
<td style="text-align:left;">
Weekendday
</td>
</tr>
<tr>
<td style="text-align:left;">
Sat - Sun otherwise
</td>
<td style="text-align:left;">
EveningNight
</td>
</tr>
</tbody>
</table>
<ul>
<li><p>Field <code>logspeed</code> contains the natural logarithm of the <em>speed</em> (in meter/second) of traversal of each link. This information is central to the estimation algorithm.</p></li>
<li><p>Field <code>traveltime</code> refers to the traversal time (in seconds) of each link. This field is mostly for reference and is not used directly in the package.</p></li>
<li><p>Field <code>length</code> refers to the length (in meters) of each link. This information is used by the prediction algorithm.</p></li>
<li><p>Field <code>time</code> gives the entry time in POSIXct format for the traversal of a given link. Individual datums are not used directly; however, the start time of the very first traversal is likely to be useful for providing the start time of a whole trip to the prediction function. Field <code>time</code> determine the time bin for each link, as illustrated in Table 1.</p></li>
</ul>
<p><code>traveltimeCLT</code> includes functionality to convert time stamps to alternative time bins, please refer to <a href="Time%20bins">Time bins</a>.</p>
</div>
<div class="section level2">
<h2 id="statistical-models">Statistical models<a class="anchor" aria-label="anchor" href="#statistical-models"></a>
</h2>
<p><strong>This section should include a detailed description of the statistical/mathematical methods implemented in the package.</strong></p>
<div class="section level3">
<h3 id="calling-traveltimeclt">Calling <code>traveltimeCLT</code><a class="anchor" aria-label="anchor" href="#calling-traveltimeclt"></a>
</h3>
<p>The estimation algorithm can be executed by calling the <code>traveltimeCLT</code> function. The function’s interface is as follows.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/traveltimeCLT.html">traveltimeCLT</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>              model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'trip-specific'</span>, <span class="st">'population'</span><span class="op">)</span>,</span>
<span>              estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'both'</span>, <span class="st">'mean-only'</span><span class="op">)</span>,</span>
<span>              lag <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>              nsamples<span class="op">=</span><span class="fl">500L</span>,</span>
<span>              min.links<span class="op">=</span><span class="fl">5L</span>,</span>
<span>              timebin_rules <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>For example, <code>traveltimeCLT</code> can be called using the <code>trips</code> <code>data.frame</code> as</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traveltimeCLT.html">traveltimeCLT</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">trips</span>,model <span class="op">=</span> <span class="st">'trip-specific'</span>, estimate <span class="op">=</span> <span class="st">'both'</span>, lag <span class="op">=</span> <span class="fl">1</span>, nsamples <span class="op">=</span> <span class="fl">500</span>, min.links <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>Table 3 provides a description for each parameter.</p>
<table class="table">
<caption>
Table 2 - Parameters for <code>traveltimeCLT</code>
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>data</code>
</td>
<td style="text-align:left;">
A data frame of trips and their road level travel information, formated as <code>trips</code>, see <code>trips</code> or <code>View(data(trips))</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>model</code>
</td>
<td style="text-align:left;">
Specifies whether the <code>trip-specific</code> or <code>population</code> models should be used.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>estimate</code>
</td>
<td style="text-align:left;">
Specifies whether to estimate <code>both</code> the mean and variance or <code>mean-only</code>. Only applied with <code>model=trip-specific</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>lag</code>
</td>
<td style="text-align:left;">
Maximum lag at which to calculate the autocorrelations. Default is 1 for the first order-autocorrelations.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>nsamples</code>
</td>
<td style="text-align:left;">
The number of trips to sample for parameter estimation.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>min.links</code>
</td>
<td style="text-align:left;">
The minimum number of links in each of the sampled trip.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>timebin_rules</code>
</td>
<td style="text-align:left;">
A list containing, start, end, days and tag for each timebin of the dataset (see example in <code>time_bins</code>).
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="a-word-on-imputation">A word on imputation<a class="anchor" aria-label="anchor" href="#a-word-on-imputation"></a>
</h3>
<p><strong>This section is taken from the HMM repo, and must be checked for applicability to the new method.</strong></p>
<p>The implementation allows imputing for combinations of road links and time bins, for which the lack of sufficient observations prevents reliable parameter estimation. When imputation is required for a given combination, estimates for <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(\Gamma\)</span> and <span class="math inline">\(\gamma\)</span> are calculated on the basis of data available for the time bin involved <em>for all road links</em>.</p>
<p>This approach differs from the one in Woodard et.al.(2016), where imputation is performed on the basis of road classification data (e.g. “arterial” or “primary collector road”). This implementation does not handle road classification data.</p>
<p>Imputation is performed in the following three cases:</p>
<ul>
<li><p>Case 1: when a combination (<code>links x timebins</code>) has fewer than <code>L</code> <em>total observations</em>;</p></li>
<li><p>Case 2: when a combination has fewer than <code>L</code> <em>initial state observations only</em>;</p></li>
<li><p>Case 3: when a combination has only initial states.</p></li>
</ul>
<p>The number of observations specified in parameter <code>L</code> determines the threshold below which imputation occurs for cases 1 and 2.</p>
</div>
<div class="section level3">
<h3 id="return-values">Return values<a class="anchor" aria-label="anchor" href="#return-values"></a>
</h3>
<p>The execution of <code>traveltimeCLT</code> returns a list of the parameters in Table 4.</p>
<table class="table">
<caption>
Table 3 - Components of the list object returned by <code>traveltimeCLT</code>
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>network parameters</code>
</td>
<td style="text-align:left;">
to complete.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>rho</code>
</td>
<td style="text-align:left;">
to complete.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>residual variance</code>
</td>
<td style="text-align:left;">
to complete.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>nsamples</code>
</td>
<td style="text-align:left;">
An integer corresponding to the number of trips sampled for parameter estimation., equal to the parameter <code>nsamples</code> that was passed in the function call.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>min.links</code>
</td>
<td style="text-align:left;">
An integer corresponding to the minimum number of links for each sampled trip, equal to the parameter <code>min.links</code> that was passed in the function call.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>lag</code>
</td>
<td style="text-align:left;">
An integer corresponding to the maximum lag for calculating the autocorrelations, equal to the parameter <code>lag</code> that was passed in the function call.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>timebin_rules</code>
</td>
<td style="text-align:left;">
A list containing details of the utilized timebins. Equals <span class="math inline">\(NULL\)</span> if default timebins are used.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>estimate</code>
</td>
<td style="text-align:left;">
A string specifying whether <code>both</code> the mean and variance or <code>mean-only</code> were calculated. Same as parameter <code>estimate</code> that was passed in the function call.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>model</code>
</td>
<td style="text-align:left;">
A string indicating whether the <code>trip-specific</code> or <code>population</code> model was used. Same as the parameter <code>model</code> that was passed in the function call.
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h2>
<p><strong>This section should include a description of the methods used for prediction.</strong></p>
<div class="section level3">
<h3 id="calling-predict-traveltime-or-predict">Calling <code>predict.traveltime</code> or <code>predict</code><a class="anchor" aria-label="anchor" href="#calling-predict-traveltime-or-predict"></a>
</h3>
<p>The prediction algorithm is executed by calling the <code>predict.traveltime</code>, or equivalently the <code>S3</code> method <code>predict</code>, which has the following interface:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>,</span>
<span>        <span class="va">newdata</span>,</span>
<span>        <span class="va">level</span>,</span>
<span>        <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>For example, we can randomly select 10 trips from the dataset <code>trips</code> to use as the test data for prediction. Once these trips are selected, we use the remaining trips to estimate the model by calling <code>traveltimeCLT</code>. The output of <code>traveltimeCLT</code> and the test data are then passed to predict to generate predictions for the 10 randomly sampled trips.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_trips</span> <span class="op">=</span> <span class="fu"><a href="../reference/sample_trips.html">sample_trips</a></span><span class="op">(</span><span class="va">trips</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">train</span> <span class="op">=</span> <span class="va">trips</span><span class="op">[</span><span class="op">!</span><span class="va">trips</span><span class="op">$</span><span class="va">tripID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_trips</span>,<span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">=</span>  <span class="va">trips</span><span class="op">[</span><span class="va">trips</span><span class="op">$</span><span class="va">tripID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_trips</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traveltimeCLT.html">traveltimeCLT</a></span><span class="op">(</span><span class="va">train</span>, lag <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">test</span>, <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<p>Table 5 provides a description for each parameter.</p>
<table class="table">
<caption>
Table 4 - Parameters for <code>predict.traveltime</code>
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>object</code>
</td>
<td style="text-align:left;">
A list object corresponding to the output <code>traveltimeCLT</code>, of class <code>traveltimeCLT</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>newdata</code>
</td>
<td style="text-align:left;">
A data frame of new trips and their road level travel information, formatted as <code>trips</code>, see <code>trips</code> or <code>data(trips); View(trips)</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>levels</code>
</td>
<td style="text-align:left;">
Significance levels. Default is 0.95.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>...</code>
</td>
<td style="text-align:left;">
For passing extra parameters, for example, time bin rules to be passed to <code>rules2timebins</code>, see <code>rules2timebins</code> in the trip-specific method.
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="return-values-1">Return values<a class="anchor" aria-label="anchor" href="#return-values-1"></a>
</h3>
<p><code>predict.traveltime</code> returns a vector of length <code>n</code>, where <code>n</code> is the number of trips passed to <code>predict</code>. For each trip, <code>predict</code> returns the tripID, ETA (trip length in seconds), variance, and the lower and upper bounds of the confidence interval of travel time, according to the specified significance level. The output for the above example is provided below.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, test, <span class="fl">0.95</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="kw">print</span>(pred)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>    tripID        ETA   variance        lwr       upr</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="dv">1</span>    <span class="dv">11273</span> <span class="fl">1734.00888</span>  <span class="fl">30990.369</span> <span class="fl">1343.40284</span> <span class="fl">2124.6149</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a><span class="dv">2</span>    <span class="dv">11396</span>  <span class="fl">784.61539</span>  <span class="fl">26200.146</span>  <span class="fl">425.46409</span> <span class="fl">1143.7667</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a><span class="dv">3</span>    <span class="dv">13922</span> <span class="fl">1277.75451</span> <span class="fl">152802.053</span>  <span class="fl">410.41290</span> <span class="fl">2145.0961</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a><span class="dv">4</span>    <span class="dv">21978</span> <span class="fl">1266.31193</span>  <span class="fl">23227.051</span>  <span class="fl">928.15163</span> <span class="fl">1604.4722</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a><span class="dv">5</span>  <span class="dv">1000165</span>   <span class="fl">55.26015</span>   <span class="fl">1175.211</span>  <span class="fl">-20.80462</span>  <span class="fl">131.3249</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a><span class="dv">6</span>  <span class="dv">1002992</span>  <span class="fl">947.83252</span>   <span class="fl">6023.799</span>  <span class="fl">775.62154</span> <span class="fl">1120.0435</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a><span class="dv">7</span>  <span class="dv">1003992</span> <span class="fl">1931.34743</span>  <span class="fl">62290.712</span> <span class="fl">1377.56748</span> <span class="fl">2485.1274</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a><span class="dv">8</span>  <span class="dv">1005895</span> <span class="fl">1247.47739</span>  <span class="fl">23665.694</span>  <span class="fl">906.13895</span> <span class="fl">1588.8158</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a><span class="dv">9</span>  <span class="dv">2001730</span> <span class="fl">1549.57224</span>  <span class="fl">39551.002</span> <span class="fl">1108.30231</span> <span class="fl">1990.8422</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a><span class="dv">10</span> <span class="dv">2004090</span> <span class="fl">2244.24231</span> <span class="fl">695368.988</span>  <span class="fl">393.98024</span> <span class="fl">4094.5044</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model-comparison">Model comparison<a class="anchor" aria-label="anchor" href="#model-comparison"></a>
</h2>
<p><strong>This section should include a discussion on the trip-specific vs population models.</strong></p>
</div>
<div class="section level2">
<h2 id="time-bins">Time bins<a class="anchor" aria-label="anchor" href="#time-bins"></a>
</h2>
<p>To specify different time bins than the ones supplied, <code>traveltimeHMM</code> provides a functional method called <code><a href="../reference/rules2timebins.html">rules2timebins()</a></code> that translates human readable weekly time bins to a conversion function.</p>
<p><code><a href="../reference/rules2timebins.html">rules2timebins()</a></code> takes a list of lists of time bin rules, where each sub-list specifies 4 variables, <code>start</code> and <code>end</code>as the start and end time of a time bin in 24h format, <code>days</code> as a vector specifying the weekdays this time bin applies to, <code>1</code> for Sunday, and <code>2:5</code> for weekdays, and finally a <code>tag</code> to specify a name for the time bin.</p>
<p>For example,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rules</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>start<span class="op">=</span><span class="st">'6:30'</span>,  end<span class="op">=</span> <span class="st">'9:00'</span>,  days <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, tag<span class="op">=</span><span class="st">'MR'</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>start<span class="op">=</span><span class="st">'15:00'</span>, end<span class="op">=</span> <span class="st">'18:00'</span>, days <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, tag<span class="op">=</span><span class="st">'ER'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>specifies two time bins calls <code>MR</code> for morning rush, and <code>ER</code> for evening rush, the former is for all weekdays and the latter is for Tuesdays to Fridays. All other time intervals are assigned a time bin called <code>Other</code>.</p>
<p>Passing <code>rules</code> to <code><a href="../reference/rules2timebins.html">rules2timebins()</a></code> would return an easy to use functional, for example</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>time_bins &lt;-<span class="st"> </span><span class="kw">rules2timebins</span>(rules)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="kw">time_bins</span>(<span class="st">"2019-08-16 15:25:00 EDT"</span>) <span class="co">## Friday</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>[<span class="dv">1</span>] <span class="st">"ER"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a><span class="kw">time_bins</span>(<span class="st">"2019-08-17 21:25:58 EDT"</span>) <span class="co">## Saturday</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>[<span class="dv">1</span>] <span class="st">"Other"</span></span></code></pre></div>
<p>To change the time bins in <code>trips</code>, run the code</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>trips<span class="op">$</span>timeBin &lt;-<span class="st"> </span><span class="kw">time_bins</span>(trips<span class="op">$</span>time)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="kw">head</span>(trips)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>  tripID linkID timeBin logspeed traveltime    length                time</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a><span class="dv">1</span>   <span class="dv">2700</span>  <span class="dv">10469</span>   Other <span class="fl">1.692292</span>  <span class="fl">13.000000</span>  <span class="fl">70.61488</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">07</span><span class="op">:</span><span class="dv">27</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a><span class="dv">2</span>   <span class="dv">2700</span>  <span class="dv">10444</span>   Other <span class="fl">2.221321</span>  <span class="fl">18.927792</span> <span class="fl">174.50487</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">07</span><span class="op">:</span><span class="dv">41</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a><span class="dv">3</span>   <span class="dv">2700</span>  <span class="dv">10460</span>   Other <span class="fl">2.203074</span>   <span class="fl">8.589937</span>  <span class="fl">77.76295</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">07</span><span class="op">:</span><span class="dv">58</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a><span class="dv">4</span>   <span class="dv">2700</span>  <span class="dv">10462</span>   Other <span class="fl">1.924290</span>  <span class="fl">14.619859</span> <span class="fl">100.15015</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">08</span><span class="op">:</span><span class="dv">07</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a><span class="dv">5</span>   <span class="dv">2700</span>  <span class="dv">10512</span>   Other <span class="fl">1.804293</span>   <span class="fl">5.071986</span>  <span class="fl">30.81574</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">08</span><span class="op">:</span><span class="dv">21</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a><span class="dv">6</span>   <span class="dv">2700</span>   <span class="dv">5890</span>   Other <span class="fl">2.376925</span>  <span class="fl">31.585355</span> <span class="fl">340.22893</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">08</span><span class="op">:</span><span class="dv">26</span></span></code></pre></div>
<p><em><em>Remark</em></em>: at package loading a default <code><a href="../reference/time_bins.html">time_bins()</a></code> functional is created, which constructs the default time bins of <code>trips</code>.</p>
<div class="section level3">
<h3 id="prediction-with-new-time-bins">Prediction with new time bins<a class="anchor" aria-label="anchor" href="#prediction-with-new-time-bins"></a>
</h3>
<p>Running the <code>trip-specific</code> model in <code>traveltimeCLT</code> with user-defined time bins requires several steps. First, the user defines the time bin rules and converts them to a functional using <code>rules2timebins</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rules</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>start<span class="op">=</span><span class="st">'6:30'</span>,  end<span class="op">=</span> <span class="st">'9:00'</span>,  days <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, tag<span class="op">=</span><span class="st">'MR'</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>start<span class="op">=</span><span class="st">'15:00'</span>, end<span class="op">=</span> <span class="st">'18:00'</span>, days <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, tag<span class="op">=</span><span class="st">'ER'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_bins</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rules2timebins.html">rules2timebins</a></span><span class="op">(</span><span class="va">rules</span><span class="op">)</span></span></code></pre></div>
<p>Second, the time bins are applied to the data, and trips are divided into training and testing sets.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trips</span><span class="op">$</span><span class="va">timeBin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/time_bins.html">time_bins</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_trips</span> <span class="op">=</span> <span class="fu"><a href="../reference/sample_trips.html">sample_trips</a></span><span class="op">(</span><span class="va">trips</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">train</span> <span class="op">=</span> <span class="va">trips</span><span class="op">[</span><span class="op">!</span><span class="va">trips</span><span class="op">$</span><span class="va">tripID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_trips</span>,<span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">=</span>  <span class="va">trips</span><span class="op">[</span><span class="va">trips</span><span class="op">$</span><span class="va">tripID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_trips</span>,<span class="op">]</span></span></code></pre></div>
<p>Third, the <code>timebin_rules</code> are passed to <code>traveltime_CLT</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traveltimeCLT.html">traveltimeCLT</a></span><span class="op">(</span><span class="va">train</span>, lag <span class="op">=</span> <span class="fl">1</span>, timebin_rules <span class="op">=</span> <span class="va">rules</span><span class="op">)</span></span></code></pre></div>
<p>Fourth, the <code>timebin_rules</code> are again passed to <code>predict</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">test</span>, <span class="fl">0.95</span>, <span class="va">rules</span><span class="op">)</span></span></code></pre></div>
<p>In order to esitmate the <code>population</code> model with user-defined time bins, the data must initially be subset according to the desired time bin, before fitting using <code>traveltimeCLT</code>. This is necessitated because the <code>population</code> model randomnly samples the data without consideration for time bins. Once user-defined time bins are applied to the data, the <code>population</code> modeln can be fit as below.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">morning_rush_trips</span> <span class="op">=</span>  <span class="va">trips</span><span class="op">[</span><span class="va">trips</span><span class="op">$</span><span class="va">timeBin</span><span class="op">==</span><span class="st">"MR"</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">test_trips</span> <span class="op">=</span> <span class="fu"><a href="../reference/sample_trips.html">sample_trips</a></span><span class="op">(</span><span class="va">trips</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">=</span> <span class="va">trips</span><span class="op">[</span><span class="op">!</span><span class="va">morning_rush_trips</span><span class="op">$</span><span class="va">tripID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_trips</span>,<span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">=</span>  <span class="va">trips</span><span class="op">[</span><span class="va">morning_rush_trips</span><span class="op">$</span><span class="va">tripID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_trips</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traveltimeCLT.html">traveltimeCLT</a></span><span class="op">(</span><span class="va">train</span>, lag <span class="op">=</span> <span class="fl">1</span>, model <span class="op">=</span> <span class="va">population</span>, timebin_rules <span class="op">=</span> <span class="va">rules</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">test</span>, <span class="fl">0.95</span>, <span class="va">rules</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Elmasri, M., Labbe, A., Larocque, D., Charlin, L,2020. “Predictive inference for travel time on transportation networks”. <a href="https://arxiv.org/abs/2004.11292" class="external-link uri">https://arxiv.org/abs/2004.11292</a></p>
<p>Woodard, D., Nogin, G., Koch, P., Racz, D., Goldszmidt, M., Horvitz, E., 2017. “Predicting travel time reliability using mobile phone GPS data”. <em>Transportation Research Part C</em>, 75, 30-44. <a href="http://dx.doi.org/10.1016/j.trc.2016.10.011" class="external-link uri">http://dx.doi.org/10.1016/j.trc.2016.10.011</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mohamad Elmasri.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
